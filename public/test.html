<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GovMap חיפוש כתובות</title>
    <script>
        function loadGovMapScript() {
            console.log("Loading GovMap API...");
            const script = document.createElement("script");
            script.src = "https://www.govmap.gov.il/govmap/api/govmap.api.js";
            script.async = true;
            script.onload = function() {
                console.log("✅ GovMap API Loaded!");
                console.log("window.govmap:", window.govmap);
            };
            script.onerror = function() {
                console.error("❌ Failed to load GovMap API.");
            };
            document.body.appendChild(script);
        }

        window.onload = loadGovMapScript;
    </script>
</head>
<body>
<h2>🔍 חיפוש כתובות עם GovMap</h2>
<input type="text" id="searchInput" placeholder="הכנס כתובת לחיפוש" />
<button onclick="searchGovMap()">חפש</button>

<ul id="results"></ul>

<script>
    function searchGovMap() {
        const input = document.getElementById("searchInput").value.trim();
        if (!input) return;

        if (window.govmap && window.govmap.geocode) {
            console.log("✅ Calling GovMap.geocode...");
            window.govmap.geocode({
                keyword: input,
                type: window.govmap.geocodeType.FullResult
            }).then(response => {
                console.log("Response:", response);
                displayResults(response.data);
            }).catch(err => console.error("❌ GovMap error:", err));
        } else {
            console.error("❌ GovMap API not loaded.");
        }
    }

    function displayResults(data) {
        const resultsList = document.getElementById("results");
        resultsList.innerHTML = ""; // Clear previous results

        if (!data || data.length === 0) {
            resultsList.innerHTML = "<li>❌ לא נמצאו תוצאות</li>";
            return;
        }

        data.forEach(item => {
            const li = document.createElement("li");
            li.textContent = item.ResultLable + ` (X: ${item.X}, Y: ${item.Y})`;
            resultsList.appendChild(li);
        });
    }
</script>
</body>
</html>